<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      th:replace="~{layout :: layout(~{::title}, ~{::main})}">
<head>
    <title>准确率统计 - 大乐透分析预测系统</title>
</head>
<body>
<main>
    <div class="container">
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="text-dark mb-3"><i class="bi bi-bar-chart me-2"></i>预测准确率统计</h2>
            </div>
        </div>

        <div class="row mb-4" th:if="${stats != null && !stats.isEmpty()}">
            <div class="col-lg-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">平均命中数对比</h5>
                    </div>
                    <div class="card-body">
                        <div id="hitChart" style="height: 300px;"></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">中奖次数对比</h5>
                    </div>
                    <div class="card-body">
                        <div id="prizeChart" style="height: 300px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-table me-2"></i>详细统计数据</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>预测方法</th>
                                        <th>预测次数</th>
                                        <th>前区平均命中</th>
                                        <th>后区平均命中</th>
                                        <th>一等奖</th>
                                        <th>二等奖</th>
                                        <th>三等奖</th>
                                        <th>四~七等奖</th>
                                        <th>总中奖</th>
                                        <th>中奖率</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="stat : ${stats}">
                                        <td>
                                            <span class="badge bg-secondary" th:text="${stat.methodName}"></span>
                                        </td>
                                        <td th:text="${stat.totalPredictions}"></td>
                                        <td>
                                            <span class="fw-bold text-danger" th:text="${stat.frontAvgHit}"></span>
                                        </td>
                                        <td>
                                            <span class="fw-bold text-primary" th:text="${stat.backAvgHit}"></span>
                                        </td>
                                        <td>
                                            <span class="prize-badge prize-1" th:if="${stat.prizeCount1 > 0}" th:text="${stat.prizeCount1}"></span>
                                            <span th:if="${stat.prizeCount1 == 0}">0</span>
                                        </td>
                                        <td>
                                            <span class="prize-badge prize-2" th:if="${stat.prizeCount2 > 0}" th:text="${stat.prizeCount2}"></span>
                                            <span th:if="${stat.prizeCount2 == 0}">0</span>
                                        </td>
                                        <td>
                                            <span class="prize-badge prize-3" th:if="${stat.prizeCount3 > 0}" th:text="${stat.prizeCount3}"></span>
                                            <span th:if="${stat.prizeCount3 == 0}">0</span>
                                        </td>
                                        <td th:text="${(stat.prizeCount4 != null ? stat.prizeCount4 : 0) + (stat.prizeCount5 != null ? stat.prizeCount5 : 0) + (stat.prizeCount6 != null ? stat.prizeCount6 : 0) + (stat.prizeCount7 != null ? stat.prizeCount7 : 0)}"></td>
                                        <td>
                                            <span class="badge bg-success" th:text="${stat.totalPrizeCount}"></span>
                                        </td>
                                        <td>
                                            <span class="fw-bold" th:text="${#numbers.formatDecimal(stat.prizeRate, 1, 2) + '%'}"></span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div th:if="${stats == null || stats.isEmpty()}" class="text-center py-5 text-muted">
                            <i class="bi bi-inbox display-4"></i>
                            <p class="mt-3">暂无统计数据</p>
                            <p>请先生成预测并进行验证</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        var stats = [[${stats}]];
        
        window.addEventListener('load', function() {
            if (stats && stats.length > 0) {
                var methods = stats.map(s => s.methodName);
                
                // 命中数对比图
                var hitChart = echarts.init(document.getElementById('hitChart'));
                hitChart.setOption({
                    tooltip: { trigger: 'axis' },
                    legend: { data: ['前区平均命中', '后区平均命中'] },
                    xAxis: {
                        type: 'category',
                        data: methods
                    },
                    yAxis: { type: 'value', name: '命中数' },
                    series: [
                        {
                            name: '前区平均命中',
                            type: 'bar',
                            data: stats.map(s => s.frontAvgHit),
                            itemStyle: { color: '#e63946' }
                        },
                        {
                            name: '后区平均命中',
                            type: 'bar',
                            data: stats.map(s => s.backAvgHit),
                            itemStyle: { color: '#457b9d' }
                        }
                    ]
                });
                
                // 中奖次数对比图
                var prizeChart = echarts.init(document.getElementById('prizeChart'));
                prizeChart.setOption({
                    tooltip: { trigger: 'axis' },
                    legend: { data: ['中奖次数', '预测次数'] },
                    xAxis: {
                        type: 'category',
                        data: methods
                    },
                    yAxis: { type: 'value' },
                    series: [
                        {
                            name: '中奖次数',
                            type: 'bar',
                            data: stats.map(s => s.totalPrizeCount),
                            itemStyle: { color: '#2a9d8f' }
                        },
                        {
                            name: '预测次数',
                            type: 'bar',
                            data: stats.map(s => s.totalPredictions),
                            itemStyle: { color: '#f4a261' }
                        }
                    ]
                });
                
                window.addEventListener('resize', () => {
                    hitChart.resize();
                    prizeChart.resize();
                });
            }
        });
    </script>
</main>
</body>
</html>
