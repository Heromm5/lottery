<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      th:replace="~{layout :: layout(~{::title}, ~{::main})}">
<head>
    <title>首页 - 大乐透分析预测系统</title>
</head>
<body>
<main>
    <div class="container">
        <!-- Hero Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-trophy me-2"></i>最新开奖结果</h5>
                    </div>
                    <div class="card-body text-center py-4" th:if="${latest != null}">
                        <h6 class="text-muted mb-3">
                            第 <span class="text-primary fw-bold" th:text="${latest.issue}"></span> 期
                            <span class="ms-2" th:text="${latest.drawDate}"></span>
                        </h6>
                        <div class="mb-3">
                            <span class="me-3 text-muted">前区</span>
                            <span class="ball ball-front" th:text="${latest.frontBall1}"></span>
                            <span class="ball ball-front" th:text="${latest.frontBall2}"></span>
                            <span class="ball ball-front" th:text="${latest.frontBall3}"></span>
                            <span class="ball ball-front" th:text="${latest.frontBall4}"></span>
                            <span class="ball ball-front" th:text="${latest.frontBall5}"></span>
                            <span class="mx-3 text-muted">后区</span>
                            <span class="ball ball-back" th:text="${latest.backBall1}"></span>
                            <span class="ball ball-back" th:text="${latest.backBall2}"></span>
                        </div>
                        <div class="row justify-content-center">
                            <div class="col-auto">
                                <small class="text-muted">
                                    和值: <span class="fw-bold text-primary" th:text="${latest.frontSum}"></span> |
                                    奇偶比: <span class="fw-bold" th:text="${latest.oddCountFront + ':' + (5 - latest.oddCountFront)}"></span> |
                                    连号: <span class="fw-bold" th:text="${latest.consecutiveCountFront}"></span>
                                </small>
                            </div>
                        </div>
                    </div>
                    <div class="card-body text-center py-4" th:if="${latest == null}">
                        <p class="text-muted mb-0">暂无开奖数据</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Row -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="stat-card">
                    <h3 th:text="${totalCount}">0</h3>
                    <p>历史数据总量</p>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card">
                    <h3 th:text="${nextIssue}">--</h3>
                    <p>下期预测期号</p>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card">
                    <h3>5</h3>
                    <p>预测算法数量</p>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card">
                    <h3 th:text="${accuracyStats != null ? accuracyStats.size() : 0}">0</h3>
                    <p>已统计方法数</p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-lightning-charge display-4 text-warning mb-3"></i>
                        <h5>智能预测</h5>
                        <p class="text-muted">使用多种算法生成下期预测号码</p>
                        <a th:href="@{/prediction}" class="btn btn-primary">立即预测</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-graph-up display-4 text-info mb-3"></i>
                        <h5>数据分析</h5>
                        <p class="text-muted">查看号码频率、遗漏、走势等分析</p>
                        <a th:href="@{/analysis/frequency}" class="btn btn-success">查看分析</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-clipboard-check display-4 text-success mb-3"></i>
                        <h5>结果比对</h5>
                        <p class="text-muted">验证预测结果，统计准确率</p>
                        <a th:href="@{/verification}" class="btn btn-secondary">开始验证</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Results & Charts -->
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-list-ol me-2"></i>近期开奖</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>期号</th>
                                        <th>前区号码</th>
                                        <th>后区</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="result : ${recentResults}">
                                        <td th:text="${result.issue}"></td>
                                        <td>
                                            <span class="ball ball-front" style="width:28px;height:28px;font-size:0.75rem;" th:text="${result.frontBall1}"></span>
                                            <span class="ball ball-front" style="width:28px;height:28px;font-size:0.75rem;" th:text="${result.frontBall2}"></span>
                                            <span class="ball ball-front" style="width:28px;height:28px;font-size:0.75rem;" th:text="${result.frontBall3}"></span>
                                            <span class="ball ball-front" style="width:28px;height:28px;font-size:0.75rem;" th:text="${result.frontBall4}"></span>
                                            <span class="ball ball-front" style="width:28px;height:28px;font-size:0.75rem;" th:text="${result.frontBall5}"></span>
                                        </td>
                                        <td>
                                            <span class="ball ball-back" style="width:28px;height:28px;font-size:0.75rem;" th:text="${result.backBall1}"></span>
                                            <span class="ball ball-back" style="width:28px;height:28px;font-size:0.75rem;" th:text="${result.backBall2}"></span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-pie-chart me-2"></i>奇偶比分布</h5>
                    </div>
                    <div class="card-body">
                        <div id="oddEvenChart" style="height: 300px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Accuracy Stats -->
        <div class="row" th:if="${accuracyStats != null && !accuracyStats.isEmpty()}">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-bar-chart me-2"></i>预测准确率统计</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>预测方法</th>
                                        <th>预测次数</th>
                                        <th>前区平均命中</th>
                                        <th>后区平均命中</th>
                                        <th>中奖次数</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="stat : ${accuracyStats}">
                                        <td th:text="${stat.methodName}"></td>
                                        <td th:text="${stat.totalPredictions}"></td>
                                        <td th:text="${stat.frontAvgHit}"></td>
                                        <td th:text="${stat.backAvgHit}"></td>
                                        <td th:text="${stat.totalPrizeCount}"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        // 奇偶比图表
        var oddEvenData = [[${oddEvenStats}]];
        
        window.addEventListener('load', function() {
            if (oddEvenData && Object.keys(oddEvenData).length > 0) {
                var chart = echarts.init(document.getElementById('oddEvenChart'));
                var option = {
                    tooltip: {
                        trigger: 'item',
                        formatter: '{b}: {c}期 ({d}%)'
                    },
                    legend: {
                        orient: 'vertical',
                        right: 10,
                        top: 'center'
                    },
                    series: [{
                        type: 'pie',
                        radius: ['40%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: false
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: 14,
                                fontWeight: 'bold'
                            }
                        },
                        data: Object.entries(oddEvenData).map(([name, value]) => ({
                            name: '奇偶比 ' + name,
                            value: value
                        }))
                    }],
                    color: ['#e63946', '#f4a261', '#2a9d8f', '#457b9d', '#1d3557', '#264653']
                };
                chart.setOption(option);
                window.addEventListener('resize', () => chart.resize());
            }
        });
    </script>
</main>
</body>
</html>
